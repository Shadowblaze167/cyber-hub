<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Dino</title>
    <style>
        :root { 
            --neon: #00ff41; 
            --urban: #ffcc00; 
            --alert: #ff003c; 
            --glass: rgba(0, 8, 0, 0.96); 
            --font: 'JetBrains Mono', monospace;
        }
        body, html { margin: 0; padding: 0; height: 100vh; overflow: hidden; font-family: var(--font); background: #000; color: var(--neon); transition: filter 0.2s ease; }

        /* --- DECOY --- */
        #decoy { position: fixed; inset: 0; z-index: 100; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 1s cubic-bezier(0.7, 0, 0.3, 1); }
        #game-box { width: 640px; height: 160px; border-bottom: 2px solid #535353; position: relative; overflow: hidden; }
        #dino { width: 40px; height: 40px; background: #535353; position: absolute; bottom: 0; left: 50px; }
        .cactus { width: 18px; height: 38px; background: #535353; position: absolute; bottom: 0; }
        #score { font-size: 32px; color: #535353; margin-bottom: 10px; font-weight: 900; }

        /* --- FX --- */
        .m-canvas { position: fixed; inset: 0; z-index: 1; opacity: 0.15; pointer-events: none; }
        #shockwave { position: fixed; top: 50%; left: 50%; width: 1px; height: 1px; background: transparent; border: 3px solid var(--neon); border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 250; opacity: 0; }
        @keyframes shock { 0% { width: 0; height: 0; opacity: 1; border-width: 40px; } 100% { width: 300vw; height: 300vw; opacity: 0; border-width: 1px; } }

        /* --- LOGIN --- */
        #login-layer { position: fixed; inset: 0; z-index: 200; display: none; background: #000; opacity: 0; transition: 0.6s; }
        .auth-card { border: 1px solid var(--neon); padding: 70px; background: #000; box-shadow: 0 0 30px rgba(0,255,65,0.1); text-align: center; }
        input[type="password"] { background: transparent; border: none; border-bottom: 2px solid var(--neon); color: #fff; font-size: 2rem; text-align: center; outline: none; letter-spacing: 12px; width: 380px; margin-top: 35px; }

        /* --- CONSOLE CORE --- */
        #console { position: fixed; inset: 0; z-index: 300; display: none; grid-template-columns: 320px 1fr 300px; grid-template-rows: 55px 1fr 250px; gap: 4px; background: #050505; padding: 4px; }
        .panel { background: var(--glass); border: 1px solid rgba(0,255,65,0.08); backdrop-filter: blur(20px); display: flex; flex-direction: column; overflow: hidden; opacity: 0; transform: translateY(20px); transition: 0.5s; }
        .panel.active { opacity: 1; transform: translateY(0); }
        .p-hdr { padding: 12px 18px; font-size: 10px; background: rgba(255,255,255,0.04); color: #888; letter-spacing: 3px; border-bottom: 1px solid rgba(255,255,255,0.08); }

        /* NEURAL INTERFACE */
        #ai-chat { flex-grow: 1; padding: 15px; font-size: 11px; overflow-y: auto; color: #fff; background: rgba(0,0,0,0.4); line-height: 1.5; scrollbar-width: none; }
        #ai-input { background: transparent; border: none; color: #fff; font-size: 12px; width: 100%; outline: none; padding: 12px; border-top: 1px solid #222; }

        /* VAULT */
        #vault-list { padding: 10px; font-size: 10px; flex-grow: 1; overflow-y: auto; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #111; color: #888; }
        .f-btn { background: transparent; border: 1px solid var(--neon); color: var(--neon); font-size: 8px; cursor: pointer; padding: 3px 7px; margin-left: 4px; }

        #term { flex-grow: 1; padding: 20px; font-size: 11px; overflow-y: auto; color: var(--neon); scrollbar-width: none; }
        .feat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; padding: 12px; }
        .btn { background: rgba(255,255,255,0.02); border: 1px solid #1a1a1a; color: #555; padding: 10px; font-size: 9px; cursor: pointer; text-align: left; }
        .prog-bar { height: 2px; background: var(--neon); width: 0%; transition: width 0.2s; }
        #laser { position: fixed; top: 0; left: -15px; width: 15px; height: 100%; background: var(--alert); z-index: 1000; display: none; }
    </style>
</head>
<body onkeydown="onKey(event)">

    <div id="laser"></div>
    <div id="shockwave"></div>

    <div id="decoy">
        <div id="score">00000</div>
        <div id="game-box"><div id="dino"></div></div>
    </div>

    <div id="login-layer">
        <canvas id="login-matrix" class="m-canvas"></canvas>
        <div style="height:100vh; display:flex; align-items:center; justify-content:center;">
            <div class="auth-card" id="auth-box">
                <input type="password" id="passkey" placeholder="••••" onkeypress="if(event.key==='Enter') startBreach()">
            </div>
        </div>
    </div>

    <div id="console">
        <canvas id="main-matrix" class="m-canvas"></canvas>
        <header style="grid-column: 1/-1; background:#000; display:flex; align-items:center; padding:0 25px; font-size:11px; border-bottom: 1px solid #1a1a1a;">
            GENESIS_ARCHITECT // TITAN_DB // NEURAL_MORPH_ENABLED
            <div style="margin-left: auto; opacity: 0.5;" id="clock">00:00:00</div>
        </header>

        <aside class="panel" id="p1">
            <div class="p-hdr">Operational_Modules</div>
            <div class="feat-grid" id="f-grid"></div>
        </aside>

        <main class="panel" id="p2">
            <div class="p-hdr">Kernel_Log</div>
            <div id="term"></div>
            <div id="p-wrap" style="padding:0 20px 15px; display:none;">
                <div style="background:#111; height:3px; width:100%;"><div id="p-engine" class="prog-bar"></div></div>
            </div>
        </main>

        <aside class="panel" id="p3">
            <div class="p-hdr">Titan_Vault</div>
            <div id="vault-list"></div>
            <input type="file" id="file-input" style="display:none" onchange="handleUpload(this)">
            <button class="btn" style="color:var(--neon); border-color:var(--neon); margin:10px;" onclick="document.getElementById('file-input').click()">INGEST_FILE</button>
        </aside>

        <aside class="panel" id="p4" style="grid-column: 1/2; grid-row: 3/4;">
            <div class="p-hdr">Neural_Architect (Gemini)</div>
            <div id="ai-chat"></div>
            <input type="text" id="ai-input" placeholder="Give theme command..." onkeypress="if(event.key==='Enter') callGemini()">
        </aside>

        <div class="panel" id="p5" style="grid-column: 2/4; grid-row: 3/4;">
            <div class="p-hdr">Visualizer_Stream</div>
            <canvas id="flow-canvas" style="width:100%; height:100%;"></canvas>
        </div>
    </div>

<script type="module">
    import { GoogleGenerativeAI, HarmCategory, HarmBlockThreshold } from "https://esm.run/@google/generative-ai";

    const API_KEY = "AIzaSyDjahWfc3S0D8nKVZB5XFrmE84a0RM3eGs";
    const genAI = new GoogleGenerativeAI(API_KEY);
    
    const safetySettings = [
      { category: HarmCategory.HARM_CATEGORY_HARASSMENT, threshold: HarmBlockThreshold.BLOCK_NONE },
      { category: HarmCategory.HARM_CATEGORY_HATE_SPEECH, threshold: HarmBlockThreshold.BLOCK_NONE },
      { category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT, threshold: HarmBlockThreshold.BLOCK_NONE },
      { category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT, threshold: HarmBlockThreshold.BLOCK_NONE },
    ];

    // UPDATED MODEL NAME TO CONCRETE VERSION "gemini-1.5-flash-001"
    const model = genAI.getGenerativeModel({ 
        model: "gemini-1.5-flash-001",
        safetySettings,
        systemInstruction: "You are the Hyperion Architect. If user wants a theme change, output ONLY a JSON object like this: {\"neon\":\"#00ff00\",\"urban\":\"#ffff00\",\"alert\":\"#ff0000\",\"glass\":\"rgba(0,0,0,0.9)\"}. Do not use markdown code blocks."
    });

    window.callGemini = async function() {
        const input = document.getElementById('ai-input');
        const chat = document.getElementById('ai-chat');
        const val = input.value; if(!val) return;
        
        chat.innerHTML += `<div style="color:var(--urban); margin-top:5px;">> USER: ${val}</div>`;
        input.value = "";
        const aiMsg = document.createElement('div');
        aiMsg.innerHTML = `> AI: Analyzing...`;
        chat.appendChild(aiMsg);
        chat.scrollTop = chat.scrollHeight;

        try {
            const result = await model.generateContent(val);
            let text = result.response.text();
            
            const jsonMatch = text.match(/\{[\s\S]*\}/);
            
            if (jsonMatch) {
                try {
                    const themeData = JSON.parse(jsonMatch[0]);
                    applyTheme(themeData);
                    text = "Aesthetic reconfiguration applied.";
                } catch (e) {
                    console.error("JSON Parse Error", e);
                }
            }

            aiMsg.innerHTML = `> AI: ${text}`;
        } catch (e) { 
            console.error(e);
            // Fallback for visual feedback
            aiMsg.innerHTML = `> AI: ERROR [${e.message || 'Model_Not_Found'}]`; 
        }
        chat.scrollTop = chat.scrollHeight;
    }

    function applyTheme(data) {
        const r = document.documentElement;
        if(data.neon) r.style.setProperty('--neon', data.neon);
        if(data.urban) r.style.setProperty('--urban', data.urban);
        if(data.alert) r.style.setProperty('--alert', data.alert);
        if(data.glass) r.style.setProperty('--glass', data.glass);
        
        document.body.style.filter = "brightness(3) contrast(2)";
        setTimeout(() => document.body.style.filter = "none", 150);
        window.log("NEURAL_ARCHITECT: UI_RECONFIGURED");
    }
</script>

<script>
    let buffer = "", score = 0, dinoY = 0, dy = 0, active = true, db;
    const feats = ["PacketSniff", "MACSpoof", "HashCrack", "SQLInject", "DDoS_Stress", "ProxyRot", "DNSTunnel", "MetaScrape", "PortScan", "SSHBrute", "SessionHi", "RootCheck", "PayloadGen", "DeepScan", "NodeJump", "TrafficMirr", "FW_Bypass", "AuthWipe", "GhostMode", "KernelDebug"];

    // DB setup
    const request = indexedDB.open("TitanVault", 1);
    request.onupgradeneeded = e => { db = e.target.result; db.createObjectStore("files", { keyPath: "id", autoIncrement: true }); };
    request.onsuccess = e => { db = e.target.result; };

    function onKey(e) {
        if(e.code === "Space" && dinoY === 0) dy = 14;
        buffer += e.key.toLowerCase();
        if(buffer.includes("root")) { buffer = ""; runWarp(); }
    }

    function gameLoop() {
        if(!active) return;
        dinoY += dy; dy -= 0.8;
        if(dinoY <= 0) { dinoY = 0; dy = 0; }
        document.getElementById('dino').style.bottom = dinoY + "px";
        score++; document.getElementById('score').innerText = score.toString().padStart(5,'0');
        requestAnimationFrame(gameLoop);
    }
    gameLoop();

    function spawn() {
        if(!active) return;
        const c = document.createElement('div');
        c.className = 'cactus'; c.style.right = '-25px';
        document.getElementById('game-box').appendChild(c);
        let pos = -25;
        const m = setInterval(() => {
            if(!active) { clearInterval(m); c.remove(); return; }
            pos += 8; c.style.right = pos + "px";
            if(pos > 520 && pos < 550 && dinoY < 40) score = 0;
            if(pos > 700) { clearInterval(m); c.remove(); }
        }, 16);
        setTimeout(spawn, 2000 + Math.random() * 2000);
    }
    spawn();

    function runWarp() {
        active = false;
        document.getElementById('laser').style.display = 'block';
        document.getElementById('laser').style.animation = 'sweep 0.7s forwards';
        setTimeout(() => {
            document.getElementById('decoy').style.display = 'none';
            document.getElementById('login-layer').style.display = 'block';
            setTimeout(() => document.getElementById('login-layer').style.opacity = '1', 50);
            drawMatrix('login-matrix');
            document.getElementById('passkey').focus();
        }, 400);
    }

    function startBreach() {
        if(btoa(document.getElementById('passkey').value) === "YWRtaW5AOTk=") {
            document.getElementById('shockwave').style.animation = "shock 1s forwards";
            setTimeout(() => {
                document.getElementById('login-layer').style.display = 'none';
                document.getElementById('console').style.display = 'grid';
                drawMatrix('main-matrix');
                initConsole();
            }, 800);
        }
    }

    function initConsole() {
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
        feats.forEach(f => document.getElementById('f-grid').innerHTML += `<button class="btn" onclick="exec('${f}')">${f}</button>`);
        updateVaultUI();
        ['p1', 'p2', 'p3', 'p4', 'p5'].forEach((id, i) => setTimeout(() => document.getElementById(id).classList.add('active'), i * 100));
        log("ARCHITECT_LINK: ESTABLISHED.");
    }

    function handleUpload(input) {
        const file = input.files[0]; if(!file) return;
        exec(`STORAGE_PROC: ${file.name}`);
        const reader = new FileReader();
        reader.onload = e => {
            const tx = db.transaction("files", "readwrite");
            tx.objectStore("files").add({ name: file.name, size: (file.size/1024).toFixed(1) + 'KB', data: e.target.result });
            tx.oncomplete = () => { updateVaultUI(); log(`INGESTED: ${file.name}`); };
        };
        reader.readAsDataURL(file);
    }

    function updateVaultUI() {
        const list = document.getElementById('vault-list'); list.innerHTML = "";
        const tx = db.transaction("files", "readonly");
        tx.objectStore("files").openCursor().onsuccess = e => {
            const cursor = e.target.result;
            if(cursor) {
                const f = cursor.value;
                list.innerHTML += `<div class="file-item"><span>${f.name}</span><div><button class="f-btn" onclick="dl(${f.id})">GET</button></div></div>`;
                cursor.continue();
            }
        };
    }

    window.dl = function(id) {
        const tx = db.transaction("files", "readonly");
        tx.objectStore("files").get(id).onsuccess = e => {
            const f = e.target.result;
            const a = document.createElement("a"); a.href = f.data; a.download = f.name; a.click();
        };
    }

    function exec(name) {
        log(`EXEC: ${name}...`);
        document.getElementById('p-wrap').style.display = 'block';
        let w = 0;
        const i = setInterval(() => {
            w += 20; document.getElementById('p-engine').style.width = w + "%";
            if(w >= 100) { clearInterval(i); setTimeout(() => document.getElementById('p-wrap').style.display = 'none', 300); }
        }, 50);
    }

    window.log = function(m) {
        const t = document.getElementById('term');
        t.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${m}</div>`;
        t.scrollTop = t.scrollHeight;
    }

    function drawMatrix(id) {
        const c = document.getElementById(id); const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        const col = Array(Math.floor(c.width/20)).fill(1);
        setInterval(() => {
            ctx.fillStyle = "rgba(0,0,0,0.06)"; ctx.fillRect(0,0,c.width,c.height);
            ctx.fillStyle = rStyle('--neon'); ctx.font = "15px monospace";
            col.forEach((y, i) => {
                ctx.fillText(String.fromCharCode(0x30A0+Math.random()*96), i*20, y*20);
                if(y*20 > c.height && Math.random() > 0.98) col[i] = 0;
                col[i]++;
            });
        }, 50);
    }
    function rStyle(v) { return getComputedStyle(document.documentElement).getPropertyValue(v); }
</script>
</body>
</html>
